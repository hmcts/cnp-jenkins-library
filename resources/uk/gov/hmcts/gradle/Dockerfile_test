FROM hmctspublic.azurecr.io/base/java:openjdk-11-debug-distroless-1.4

WORKDIR /opt/app
USER hmcts

COPY --chown=hmcts:hmcts . /opt/app/

RUN ["/busybox/sh", "-c", "gradlew --info --no-daemon --rerun-tasks --init-script init.gradle testClasses || :"]
RUN ["/busybox/sh", "-c", "gradlew --info --no-daemon --rerun-tasks --init-script init.gradle smokeTestClasses || :"]
RUN ["/busybox/sh", "-c", "gradlew --info --no-daemon --rerun-tasks --init-script init.gradle functionalTestClasses || :"]

ENTRYPOINT ["sh", "runTests.sh"]
